<!--
  Generated template for the Car page.

  See http://ionicframework.com/docs/v2/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

   <ion-navbar>
      <ion-title>购物车</ion-title>
      <ion-buttons right>
         <button ion-button clear *ngIf="carDetails&&carDetails?.suppliers_goods_list?.length!=0" (click)="isEdit=!isEdit;">{{isEdit?'取消':'编辑'}}</button>
      </ion-buttons>
   </ion-navbar>

</ion-header>


<ion-content>
   <ion-refresher (ionRefresh)="doRefresh($event)" pullMax="60">
      <ion-refresher-content refreshingSpinner="1" pullingIcon="0"></ion-refresher-content>
   </ion-refresher>
   <nothing backgroundImg="url(./assets/icon/no-cart.png)" *ngIf="carDetails?.suppliers_goods_list.length==0"></nothing>
   <ion-list>
      <!-- ——————————————————————— 店铺 ——————————————————————— -->
      <div class="single-shop" *ngFor="let item1 of carDetails?.suppliers_goods_list">
         <div class="single-shop-head" tappable navPush="ParticularsHomePage" [navParams]="{suppliersId:item1.suppliers_id}">
            <ion-checkbox *ngIf="!isEdit" color="jingku1" tappable (click)="checkGoods(item1.suppliers_id,1,item1.is_select==1?0:1);" [checked]="item1?.is_select==1" mode="ios" margin-left></ion-checkbox>
            <ion-checkbox *ngIf="isEdit" color="jingku1" (click)="check1(item1,carDetails)" [(ngModel)]="item1.selected" mode="ios" margin-left></ion-checkbox>
            <ion-item mode="ios" no-lines>
               <ion-icon color="colorsix" name="shop"></ion-icon>
               <span>{{item1.title}}</span>
               <ion-icon color="colorsix" name="ios-arrow-forward"></ion-icon>
               <!--<button item-right ion-button clear color="danger">优惠券???</button>-->
            </ion-item>
         </div>
         <!-- ——————————————————————— 商品 ——————————————————————— -->
         <div class="single-shop-goods" [class.disable]="!item2.in_area_id||item2.is_on_sale=='0'" *ngFor="let item2 of item1.goods_list ">
            <div class="single-shop-goods-head">
               <div *ngIf="(item2.in_area_id&&item2.is_on_sale!='0')||isEdit">
                  <ion-checkbox margin-left *ngIf="!isEdit" tappable (click)="checkGoods(item2.cutting_id>0?item2.g_parent_id:item2.goods_id,item2.cutting_id>0?3:0,item2.is_select==1?0:1)" [checked]="item2?.is_select==1" color="jingku1" mode="ios"></ion-checkbox>
                  <ion-checkbox margin-left *ngIf="isEdit" tappable color="jingku1" (click)="check2(item2,item1)" [(ngModel)]="item2.selected" mode="ios"></ion-checkbox>
               </div>
               <ion-item margin-left no-lines (click)="goParticularPage(item2)">
                  <ion-thumbnail item-left tappable>
                     <img img-lazy-load="{{item2.goods_thumb}}">
                  </ion-thumbnail>
                  <h2 tappable>{{item2.cutting_id>0?item2.cutting_name:item2.goods_name}}</h2>
                  <span tappable class="type" *ngIf="item2?.gift_list">{{item2?.gift_list?.title}}</span>
                  <span tappable class="type" *ngIf="!item2.in_area_id">不在本地区销售</span>
                  <span tappable class="type" *ngIf="item2.is_on_sale=='0'">此商品已下架</span>
               </ion-item>
            </div>
            <!-- ——————————————————————— 商品属性 ——————————————————————— -->
            <div class="single-shop-goods-body">
               <div class="item-wrap" *ngFor="let item3 of item2.attrs;">
                  <div margin-left *ngIf="(item2.in_area_id&&item2.is_on_sale!='0')||isEdit">
                     <ion-checkbox margin-right *ngIf="!isEdit&&!(item3.cutting_id>0)" [(ngModel)]="item3.is_select" [checked]="item3.is_select" tappable color="jingku1" (click)="checkGoodsAttr(item3.rec_id,item3.is_select==1?1:0)" mode="ios"></ion-checkbox>
                     <ion-checkbox margin-right *ngIf="isEdit&&!(item3.cutting_id>0)" [(ngModel)]="item3.selected" (click)="check3(item3,item2,item1)" tappable color="jingku1" mode="ios"></ion-checkbox>
                  </div>
                  <div class="sliding-item-box" [style.marginLeft]="item3.cutting_id>0?'36px':'0'">
                     <ion-item-sliding>
                        <ion-item no-lines>
                           <div class="goodsinfo">
                              <div class="attr" *ngIf="item2?.cutting_id==0">
                                 <span *ngIf="item3.qiujing">球镜：{{item3.qiujing}}</span>
                                 <span *ngIf="item3.zhujing">柱镜：{{item3.zhujing}}</span>
                                 <span *ngIf="item3.zhouwei">轴位：{{item3.zhouwei}}</span>
                                 <span *ngFor="let item4 of (item3?.arr_attr);">{{item4}}</span>
                              </div>
                              <div class="attr" *ngIf="item2?.cutting_id>0">
                                 <span *ngFor="let item4 of item2.cutting_attr;">
                                                <span style="white-space: initial;" *ngFor="let item5 of item4;">{{item5}}</span>
                                 </span>
                              </div>
                              <div class="bottom">
                                 <div class="price" *ngIf="item3?.cha_price&&mine?.showPrice">{{item3?.shop_goods_price}}
                                    <span class="old">¥{{item3?.goods_price}}</span>
                                 </div>
                                 <div class="price" *ngIf="!item3?.cha_price&&mine?.showPrice">¥{{item3?.goods_price}}</div>&nbsp;
                                 <div class="number">
                                    <count-input [minValue]="item3?.goods_properties?.number||1" [maxValue]="item3?.product_number=='-1'?item2?.g_goods_number:item3?.product_number" [rank]="item3?.goods_properties?.number" (valueChange)="numberChangeI($event,item3)" [value]="item3?.goods_number"
                                       [hasBorder]="true"></count-input>
                                 </div>
                              </div>
                              <div style="font-size: 1rem;color: #e60000;" *ngIf="item3?.gift_list?.title">{{item3?.gift_list?.title}}</div>
                           </div>
                        </ion-item>
                        <ion-item-options side="right">
                           <button ion-button color="danger" tappable (click)="deleteItem(item3)">删除</button>
                        </ion-item-options>
                     </ion-item-sliding>
                  </div>
               </div>
            </div>
         </div>
         <div class="single-shop-little-result">
            <span>共{{item1?.goods_count}}件</span>
            <span *ngIf="mine?.showPrice">
                    <span class="fgx">|</span>
            <span>小计：</span>
            <span class="red">¥{{item1?.goods_price_total}}</span>
            </span>
         </div>
         <div class="background"></div>
      </div>
   </ion-list>
</ion-content>
<ion-footer>
   <div class="car-accounts" *ngIf="carDetails&&carDetails?.suppliers_goods_list?.length!=0">
      <div class="left">
         <label tappable class="select-all" margin-horizontal>
                <ion-checkbox color="jingku1" *ngIf="!isEdit" tappable (click)="checkGoods(null,2,carDetails.total.is_select?0:1)" [checked]="carDetails.total.is_select"
                    margin-right color="jingku1" mode="ios"></ion-checkbox>
                <ion-checkbox color="jingku1" [(ngModel)]="carDetails.selected" (click)="checkAll()" *ngIf="isEdit" mode="ios" margin-right></ion-checkbox>
                全选
            </label>
         <div *ngIf="!isEdit&&mine?.showPrice" class="price">
            <div class="total">合计：¥{{carDetails?.total?.goods_amount | tofixed}}</div>
            <div class="subtotal" *ngIf="carDetails?.total?.reduce_price!=0">
               总额：¥{{carDetails?.total?.old_price_amount | tofixed}} 立减：¥{{carDetails?.total?.reduce_price | tofixed}}
            </div>
         </div>
      </div>
      <div *ngIf="!isEdit" class="right" tappable (click)="goAccounts()">去结算（{{carDetails?.total?.real_goods_count}}）</div>
      <div *ngIf="isEdit" class="attention-and-delete">
         <button ion-button outline color="jingku1" (click)="beCareFor()">移入关注</button>
         <button ion-button color="jingku1" (click)="dropCartGoodsSelect()">　删除　</button>
      </div>
   </div>
</ion-footer>