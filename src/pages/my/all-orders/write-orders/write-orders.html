<!--
  Generated template for the WriteOrders page.

  See http://ionicframework.com/docs/v2/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

    <ion-navbar>
        <ion-title>填写订单</ion-title>
    </ion-navbar>

</ion-header>


<ion-content>
    <ng-container *ngIf="data">
        <div class="fore fore1" tappable (click)="openOrderModalShippingPage()" *ngIf="defaultShipping">
            <div class="wrap">
                <div>{{defaultShipping.consignee}}<span class="phone">{{defaultShipping.mobile | phonenumberfilter}}</span></div>
                <div>{{defaultShipping.address}}</div>
            </div>
        </div>
        <div class="fore fore1" tappable (click)="openOrderModalShippingPage()" *ngIf="!defaultShipping">
            <div class="wrap">
                选择收货地址
            </div>
        </div>
        <!-- <ion-item class="fore" mode="ios" no-lines margin-right detail-push tappable (click)="openOrderPaymentModal(data)">
            支付方式
            <ng-container item-right *ngFor="let mtd of data?.payment_list">
                <ion-note style="margin:0;" *ngIf="mtd.selected==1">{{mtd.pay_name}}</ion-note>
            </ng-container>
        </ion-item> -->
        <ng-container *ngIf="data?.total?.real_goods_count==1">
            <ion-list class="fore fore2" *ngFor="let item of data?.cart_goods_list;let i=index">
                <!-- <ion-item-divider>
                <span ion-text color="danger">订单{{i+1}}: </span>{{item.title}}
            </ion-item-divider> -->
                <div class="goods-list" *ngFor="let goods of item?.goods_list;">
                    <ion-item no-lines>
                        <ion-thumbnail item-left tappable navPush="ParticularsPage" [navParams]="{goodsId:goods.goods_id}">
                            <img img-lazy-load="{{goods.goods_img}}">
                        </ion-thumbnail>
                        <h2>{{goods.goods_name}}</h2>
                        <span class="type" *ngIf="goods?.gift_list">{{goods?.gift_list?.title}}</span>
                    </ion-item>
                    <div class="attr-wrap">
                        <div class="one" *ngFor="let attr of goods?.attrs;">
                            <div class="left">
                                <div class="top">
                                    <div *ngIf="attr.qiujing">球镜：{{attr.qiujing}}</div>
                                    <div *ngIf="attr.zhujing">柱镜：{{attr.zhujing}}</div>
                                    <div *ngIf="attr.zhouwei">轴位：{{attr.zhouwei}}</div>
                                    <div *ngFor="let attr2 of attr?.attrs;">{{attr2}}</div>
                                </div>
                                <div class="bottom">
                                    <div>单价：{{attr.goods_price}}</div>
                                </div>
                            </div>
                            <div class="right">
                                <div class="price color">¥{{attr.formated_subtotal}}</div>
                                <div class="count">x{{attr.goods_number}}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="result">小计：<span class="price">{{item.goods_subtotal}}</span> 共{{item.count_goods}}件</div> -->
            </ion-list>
        </ng-container>
        <ng-container *ngIf="data?.total?.real_goods_count>1">
            <div class="fore more-goods">
                <ion-item mode="ios" detail-push no-lines tappable navPush="GoodslistPage">
                    <ng-container item-left *ngFor="let item of data?.cart_goods_list">
                        <ng-container *ngFor="let goods of item?.goods_list;let i=index">
                            <ion-thumbnail item-left *ngIf="i<2">
                                <img img-lazy-load="{{goods.goods_img}}">
                            </ion-thumbnail>
                        </ng-container>
                    </ng-container>
                    <ion-note item-end><span style="font-weight: 700;" *ngIf="data?.total?.real_goods_count>3">···</span>&nbsp;共{{data?.total?.real_goods_count||'0'}}件</ion-note>
                </ion-item>
            </div>
        </ng-container>
        <ion-list class="fore fore4">
            <ion-item mode="ios" detail-push tappable (click)="goPayAndShipPage()" style="border-top:none;">
                支付配送
                <ion-note item-end text-end class="payment-note">
                    <ng-container *ngFor="let item of data?.payment_list">
                        <div *ngIf="item.selected">{{item.pay_name}}</div>
                    </ng-container>
                    <div>{{selectedShip}}</div>
                </ion-note>
            </ion-item>
            <ion-item mode="ios" tappable (click)="goUsecouponPage()" detail-push class="coupon">
                优惠券选择
                <span class="count">已选{{selectedBonus.length||0}}张</span>
                <span class="count">{{data?.yes_bonus?.length||0}}张可用</span>
                <ion-note item-end>
                    - ¥{{data?.total?.bonus_formated}}
                </ion-note>
            </ion-item>
            <ion-item mode="ios" detail-push tappable (click)="goBusinessmenNotePage()" style="border-bottom:none;">
                商家备注
                <ion-note item-end *ngIf="noteStatus">填写备注信息</ion-note>
                <ion-note item-end *ngIf="!noteStatus">已填写备注，点击查看</ion-note>
            </ion-item>
        </ion-list>
        <!--<ion-item mode="ios" no-lines margin-right detail-push>
            来镜加工
        </ion-item>-->
        <!-- <div class="fore option">
            <ion-item mode="ios" detail-push *ngIf="item?.shipping?.length!=0" tappable (click)="openOrderModalDistributionPage(item)">
                配送方式
                <ion-note item-right style="margin:0;" *ngFor="let mtd of item.shipping">
                    <span *ngIf="mtd.selected==1">{{mtd.shipping_name}}</span>
                </ion-note>
            </ion-item>
            <ion-item mode="ios" detail-push *ngIf="item?.shipping?.length==0">
                配送方式
                <ion-note style="margin:0;" item-right>
                    <span>无配送方式</span>
                </ion-note>
            </ion-item>
            <ion-item mode="ios" detail-push *ngIf="item.use_bonus?.length!=0&&goodsType!='integral'" tappable (click)="openOrderModalCouponPage(item)">
                优惠券选择
                <ion-note style="margin:0;" item-right>
                    可使用{{item.use_bonus?.length}}个优惠券
                </ion-note>
            </ion-item>
            <ion-item mode="ios" detail-push *ngIf="item.use_bonus?.length==0&&goodsType!='integral'">
                优惠券选择
                <ion-note style="margin:0;" item-right>
                    无可用优惠券
                </ion-note>
            </ion-item>
            <div class="input">
                <input type="text" [(ngModel)]="item.beizhu" placeholder="商家备注">
            </div>
        </div> -->
        <div class="fore fore3" *ngIf="goodsType!='integral'">
            <div>
                <span>商品金额：</span>
                <span class="price">¥{{data?.total?.formated_goods_price}}</span>
            </div>
            <div>
                <span>运费：</span>
                <span class="price">+ {{data?.total?.suppliers_shipping_fee_formated}}</span>
            </div>
            <div *ngIf="data?.total?.formated_subsidy_price!=0">
                <span>商品补贴：</span>
                <span class="price">-¥{{data?.total?.formated_subsidy_price}}</span>
            </div>
            <div *ngIf="data?.total?.formated_shipping_subsidy.slice(1)!=0">
                <span>运费补贴：</span>
                <span class="price">- {{data?.total?.formated_shipping_subsidy}}</span>
            </div>
            <div *ngIf="data?.total?.bonus_formated!=0">
                <span>优惠券：</span>
                <span class="price">- ¥{{data?.total?.bonus_formated}}</span>
            </div>
            <div *ngIf="data?.total?.will_get_integral!=0">
                <span>消费积分：</span>
                <span class="price">+ {{data?.total?.will_get_integral}}</span>
            </div>
        </div>
        <div class="fore fore3" *ngIf="goodsType=='integral'">
            <div>
                <span>购物积分：</span><span class="price">+ ¥{{data?.total?.integral}}</span>
            </div>
            <div>
                <span>配送费用：</span><span>- {{data?.total?.suppliers_shipping_fee_formated}}</span>
            </div>
        </div>
    </ng-container>

</ion-content>

<ion-footer>
    <ion-toolbar no-padding *ngIf="data">
        <div class="pagefoot">
            <div class="left">
                <span class="price">实付款: ¥{{data?.total?.amount_formated}}</span><span *ngIf="goodsType=='integral'">&nbsp;积分: <span class="price">{{data?.total?.integral}}</span></span>
            </div>
            <div class="right">
                <div ion-button no-margin full large color="dark" tappable (click)="onsubmit()">提交订单</div>
            </div>
        </div>
    </ion-toolbar>
</ion-footer>