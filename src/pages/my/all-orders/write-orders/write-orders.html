<!--
  Generated template for the WriteOrders page.

  See http://ionicframework.com/docs/v2/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

    <ion-navbar>
        <ion-title>填写订单</ion-title>
    </ion-navbar>

</ion-header>


<ion-content>
    <div class="fore1" (click)="openOrderModalShippingPage()" *ngIf="defaultShipping">
        <div class="wrap">
            <div>{{defaultShipping.consignee}}<span class="phone">{{defaultShipping.mobile|phonenumberfilter}}</span></div>
            <div>{{defaultShipping.address}}</div>
        </div>
    </div>
    <div class="fore1" (click)="openOrderModalShippingPage()" *ngIf="!defaultShipping">
        <div class="wrap">
            请选择收货地址
        </div>
    </div>
    <div class="background"></div>
    <ion-item mode="ios" no-lines margin-right detail-push (click)="openOrderPaymentModal(data)">
        支付方式
        <ion-note item-right style="margin:0;" *ngFor="let mtd of data?.payment_list">
            <span *ngIf="mtd.selected==1">{{mtd.pay_name}}</span>
        </ion-note>
    </ion-item>
    <div class="background"></div>
    <ion-item-divider>
        货品清单
    </ion-item-divider>
    <ion-list class="fore2" *ngFor="let item of data?.cart_goods_list;let i=index">
        <ion-item-divider>
            <span ion-text color="danger">订单{{i+1}}: </span>{{item.title}}
        </ion-item-divider>
        <div class="goods-list" *ngFor="let goods of item?.goods_list;">
            <ion-item no-lines>
                <ion-thumbnail item-left>
                    <img src="{{goods.goods_img}}">
                </ion-thumbnail>
                <h2>{{goods.goods_name}}</h2>
                <span class="type">促销???</span>
            </ion-item>
            <div class="attr-wrap">
                <div class="one" *ngFor="let attr of goods?.attrs;">
                    <div class="left">
                        <div class="top">
                            <div *ngIf="attr.qiujing">球镜：{{attr.qiujing}}</div>
                            <div *ngIf="attr.zhujing">柱镜：{{attr.zhujing}}</div>
                            <div *ngIf="attr.zhouwei">轴位：{{attr.zhouwei}}</div>
                            <div *ngFor="let attr2 of attr?.attrs;">{{attr2}}</div>
                        </div>
                        <div class="bottom">
                            <div>单价：{{attr.goods_price}}/副</div>
                        </div>
                    </div>
                    <div class="right">
                        <div class="price color">¥{{attr.formated_subtotal}}</div>
                        <div class="count">{{attr.goods_number}}副</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="option" margin-right>
            <ion-item mode="ios" detail-push *ngIf="item?.shipping?.length!=0" (click)="openOrderModalDistributionPage(item)">
                配送方式
                <ion-note item-right style="margin:0;" *ngFor="let mtd of item.shipping">
                    <span *ngIf="mtd.selected==1">{{mtd.shipping_name}}</span>
                </ion-note>
            </ion-item>
            <ion-item mode="ios" detail-push *ngIf="item?.shipping?.length==0">
                配送方式
                <ion-note style="margin:0;" item-right>
                    <span>无配送方式</span>
                </ion-note>
            </ion-item>
            <ion-item mode="ios" detail-push *ngIf="item.use_bonus?.length!=0" (click)="openOrderModalCouponPage(item)">
                优惠券选择
                <ion-note style="margin:0;" item-right>
                    可使用{{item.use_bonus?.length}}个优惠券
                </ion-note>
            </ion-item>
            <ion-item mode="ios" detail-push *ngIf="item.use_bonus?.length==0">
                优惠券选择
                <ion-note style="margin:0;" item-right>
                    无可用优惠券
                </ion-note>
            </ion-item>
            <div class="input">
                <input type="text" [(ngModel)]="item.beizhu" placeholder="商家备注">
            </div>
        </div>
        <div class="result">小计：<span class="price">{{item.goods_subtotal}}</span> 共{{item.count_goods}}件</div>
    </ion-list>
    <ion-item mode="ios" no-lines margin-right detail-push>
        来镜加工
    </ion-item>
    <div class="background"></div>
    <div class="fore3">
        <div>
            <span>购物金额小计：</span><span class="price">¥{{data?.total?.formated_goods_price}}</span>
        </div>
        <div>
            <span>+配送费用：</span><span>{{data?.total?.suppliers_shipping_fee_formated}}</span>
        </div>
        <div>
            <span>+商品补贴：</span><span>¥{{data?.total?.formated_subsidy_price}}</span>
        </div>
        <div>
            <span>+运费补贴：</span><span>{{data?.total?.formated_shipping_subsidy}}</span>
        </div>
        <div>
            <span>+优惠券：</span><span>¥{{data?.total?.bonus_formated}}</span>
        </div>
        <div>
            <span>+获赠积分：</span><span>{{data?.total?.will_get_integral}}</span>
        </div>
    </div>
</ion-content>

<ion-footer>
    <div class="pagefoot">
        <div class="left">
            合计：<span class="price">¥{{data?.total?.amount_formated}}</span>
        </div>
        <div class="right">
            <div ion-button no-margin full large color="dark" (click)="onsubmit()">提交订单</div>
        </div>
    </div>
</ion-footer>